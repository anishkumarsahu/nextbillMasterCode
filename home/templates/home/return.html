{% extends 'home/index.html' %}
{% load static %}
{% block title %}
    <title>Return</title>
{% endblock %}
{% block css %}
{% endblock %}
{% block body %}
  <style>
     #expenseTable_length {
            left: 10px;
            position: absolute;
        }

        #expenseTable_filter {
            float: right;
        }

        .dt-buttons {
            position: absolute;
            left: 200px;
        }
  label{
      float: left;
  }
  .segment{
      padding-top: 3px!important;
      padding-bottom: 0!important;
  }
    </style>
    <div class="ui right aligned basic  segment" style="padding-top: 0;">
                <div class="ui bottom attached segment" style="margin-top: 0;padding-bottom: 0;">
                    <form class="ui tiny form" id="expenseForm">
                        <h4 class="ui  left aligned  dividing header">RETURN</h4>

                        <div class="four fields">

                            <div class="field"> </div>

                            <div class="field">
                                <label>Invoice Number</label>
                                <input type="text" name="invoiceNumberSearch" id="invoiceNumberSearch" placeholder="Invoice Number">
                            {% csrf_token %}
                            </div>

                            <div class="field" style="padding-top: 1.666em;">
                                <button type="button" class="ui fluid green button" onclick="GetSaleDetail()">
                                    <i class="icon search"></i>
                                    Search Invoice
                                </button>
                            </div>
                             <div class="field"> </div>
                        </div>

                    </form>
                </div>

                </div>

<div id="showDiv" style="display: none;">
<div class="ui basic segment">
<h5 class="ui horizontal left aligned divider header">
                        <i class="left align icon"></i>
                        Invoice Detail
                    </h5>
     <div class="content placeholder " style="height: 7rem;overflow-y: scroll;background-color: lightgrey">
            <div class="description">


                    <div class="ui pointing secondary menu">
                        <a class="item active" data-tab="first">Basic Details</a>
                        <a class="item" data-tab="second">Addition Details</a>
                    </div>
                    <div class="ui tab segment active" data-tab="first" style="background-color: lightgrey">
                        <div class="ui internally grid">
                            <div class="row" style="padding-top: 1.5rem;padding-bottom: 1.5rem;" >
                                <div class="three wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="user icon"></i>
                                            <div class="content">
                                                <a class="header">Name:</a>
                                                <div class="description" id="CustName">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="registered icon"></i>
                                            <div class="content">
                                                <a class="header">GST Reg :</a>
                                                <div class="description" id="custGst">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="mobile icon"></i>
                                            <div class="content">
                                                <a class="header">Phone Number:</a>
                                                <div class="description" id="custPhone">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="mail icon"></i>
                                            <div class="content">
                                                <a class="header">Email:</a>
                                                <div class="description" id="custEmail">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="map marker alternate icon"></i>
                                            <div class="content">
                                                <a class="header">Address:</a>
                                                <div class="description" id="custAddress">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="street view icon"></i>
                                            <div class="content">
                                                <a class="header">State :</a>
                                                <div class="description" id="custState">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="two wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">

                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="scroll icon"></i>
                                            <div class="content">
                                                <a class="header"> Invoice No:</a>
                                                <div class="description" id="sInvoice">N/A</div>
                                            </div>
                                        </div>
                                         <div class="item" style="padding-bottom: 0;">
                                            <i class="amazon pay icon"></i>
                                            <div class="content">
                                                <a class="header">Payment Type:</a>
                                                <div class="description" id="sPaymentType">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="calendar alternate icon"></i>
                                            <div class="content">
                                                <a class="header">Date :</a>
                                                <div class="description" id="sInvoiceDate">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="two wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="sticky note outline icon"></i>
                                            <div class="content">
                                                <a class="header">Sub Total:</a>
                                                <div class="description" id="sSubTotal">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="percent icon"></i>
                                            <div class="content">
                                                <a class="header">Discount Pc:</a>
                                                <div class="description" id="sDiscount">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="pencil alternate icon"></i>
                                            <div class="content">
                                                <a class="header">Taxable :</a>
                                                <div class="description" id="sTaxable">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="two wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">

                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="registered icon"></i>
                                            <div class="content">
                                                <a class="header">GST:</a>
                                                <div class="description" id="sBillGst">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="bullseye icon"></i>
                                            <div class="content">
                                                <a class="header">Round Off:</a>
                                                <div class="description" id="sRoundOff">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="people carry icon"></i>
                                            <div class="content">
                                                <a class="header">Other Charges :</a>
                                                <div class="description" id="sOtherCharges">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="two wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                        <i class="gem icon"></i>
                                        <div class="content">
                                            <a class="header">Personal Discount:</a>
                                            <div class="description" id="sPersonalDiscount">N/A</div>
                                        </div>
                                    </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="wallet icon"></i>
                                            <div class="content">
                                                <a class="header">Total :</a>
                                                <div class="description" id="sGrandTotal">N/A</div>
                                            </div>
                                        </div>

                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="money bill wave icon"></i>
                                            <div class="content">
                                                <a class="header">Paid Amount:</a>
                                                <div class="description" id="PaidAgainstBill">N/A</div>
                                            </div>
                                        </div>


                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="ui  tab segment" data-tab="second" style="background-color: lightgrey">
                        <div class="ui internally grid">
                            <div class="row" style="padding-top: 1.5rem;padding-bottom: 1.5rem;" >
                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="handshake icon"></i>
                                            <div class="content">
                                                <a class="header">Credit Days:</a>
                                                <div class="description" id="CreditDays">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="file alternate outline icon"></i>
                                            <div class="content">
                                                <a class="header">Cheque Detail :</a>
                                                <div class="description" id="chequeDetail">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="paperclip icon"></i>
                                            <div class="content">
                                                <a class="header">Delivery Note:</a>
                                                <div class="description" id="deliveryNote">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="check double icon"></i>
                                            <div class="content">
                                                <a class="header">Supplier Reference:</a>
                                                <div class="description" id="SupplierReference">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="clipboard check icon"></i>
                                            <div class="content">
                                                <a class="header">Buyers Order Number:</a>
                                                <div class="description" id="BuyersOrderNumber">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="clipboard list icon"></i>
                                            <div class="content">
                                                <a class="header">Dispatch Document Number :</a>
                                                <div class="description" id="DispatchDocumentNumber">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="shipping fast icon"></i>
                                            <div class="content">
                                                <a class="header">Dispatch Through:</a>
                                                <div class="description" id="DispatchThrough">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="pen fancy icon"></i>
                                            <div class="content">
                                                <a class="header"> Other Reference:</a>
                                                <div class="description" id="OtherReference">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="calendar check icon"></i>
                                            <div class="content">
                                                <a class="header">Dispatch Note Date :</a>
                                                <div class="description" id="DispatchNoteDate">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="warehouse icon"></i>
                                            <div class="content">
                                                <a class="header">Destination:</a>
                                                <div class="description" id="Destination">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="user circle icon"></i>
                                            <div class="content">
                                                <a class="header">AddedBy:</a>
                                                <div class="description" id="AddedBy">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>


            </div>
        </div>
</div>
<div class="ui basic segment">
<h5 class="ui horizontal left aligned divider header">
                        <i class="left align icon"></i>
                        Product List
                    </h5>
<table id="itemTableReport" class="ui very compact celled definition table">
  <thead class="full-width">
    <tr>
      <th>SlNo.</th>
      <th>Product Name</th>
      <th>Category</th>
      <th>HSN</th>

      <th>Quantity</th>
      <th>Unit</th>
              <th>Rate(₹)</th>
              <th>GST%</th>
              <th>Disc%</th>
              <th>Rate(₹)</th>
      <th>Return Qty</th>
      <th>Return Amt.(₹)</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="collapsing">
        #
      </td>
      <td>Rice</td>
      <td>145</td>
      <td>5</td>
      <td>Kg</td>
      <td><div class="ui mini  input">
  <input type="text" placeholder="Return Quantity">
</div></td>
      <td>No</td>
    </tr>
  </tbody>
  <tfoot class="full-width">
    <tr>
      <th></th>
      <th colspan="6">
           <div class="ui floated small green labeled icon button">
          <i class="rupee sign icon"></i> Total Return Amount (₹) : <span id="returnAmount">0.00</span>
        </div>
        <div class="ui right floated small primary labeled icon button">
          <i class="check icon"></i> Make Return
        </div>

      </th>
    </tr>
  </tfoot>
</table>
</div>
</div>
{% endblock %}


{% block js %}
    <script>
     $('.menu .item').tab();
  function GetSaleDetail() {
            var invoice = $('#invoiceNumberSearch').val();
            if(invoice!==''){
            $.ajax({
                type: 'get',
                url: '/api/get_sales_detail_by_invoice_number/?invoice='+invoice ,

                success: function (response) {

                    if(response.message == 'success'){
                        $('#showDiv').css('display','block');
                                   $('body')
                        .toast({
                            class: 'success',
                            message: 'Invoice details found!'
                        })
                    ;
                               $('#itemTableReport tbody tr').remove();
                    $('#CustName').html(response.data.Basic['Name']);
                    $('#custGst').html(response.data.Basic['Gst']);
                    $('#custPhone').html(response.data.Basic['Phone']);
                    $('#custEmail').html(response.data.Basic['Email']);
                    $('#custAddress').html(response.data.Basic['Address']);
                    $('#custState').html(response.data.Basic['State']);
                    $('#sPaymentType').html(response.data.Basic['PaymentType']);
                    $('#sInvoice').html(response.data.Basic['Invoice']);
                    $('#sInvoiceDate').html(response.data.Basic['InvoiceDate']);
                    $('#sTaxable').html(response.data.Basic['Taxable']);
                    $('#sSubTotal').html(response.data.Basic['SubTotal']);
                    $('#sDiscount').html(response.data.Basic['Discount']);
                    $('#sGrandTotal').html(response.data.Basic['GrandTotal']);
                    $('#sRoundOff').html(response.data.Basic['RoundOff']);
                    $('#sTotalFinal').html(response.data.Basic['TotalFinal']);
                    $('#sBillGst').html(response.data.Basic['BillGst']);
                    $('#CreditDays').html(response.data.Basic['CreditDays']);
                    $('#chequeDetail').html(response.data.Basic['chequeDetail']);
                    $('#deliveryNote').html(response.data.Basic['deliveryNote']);
                    $('#SupplierReference').html(response.data.Basic['SupplierReference']);
                    $('#BuyersOrderNumber').html(response.data.Basic['BuyersOrderNumber']);
                    $('#DispatchDocumentNumber').html(response.data.Basic['DispatchDocumentNumber']);
                    $('#DispatchThrough').html(response.data.Basic['DispatchThrough']);
                    $('#OtherReference').html(response.data.Basic['OtherReference']);
                    $('#DispatchNoteDate').html(response.data.Basic['DispatchNoteDate']);
                    $('#Destination').html(response.data.Basic['Destination']);
                    $('#sOtherCharges').html(response.data.Basic['OtherCharges']);
                    $('#PaidAmount').html(response.data.Basic['PaidAmount']);
                    $('#DueOrReturnAmount').html(response.data.Basic['DueOrReturnAmount']);
                    $('#PaidAgainstBill').html(response.data.Basic['PaidAgainstBill']);
                    $('#AddedBy').html(response.data.Basic['AddedBy']);
                    $('#sPersonalDiscount').html(response.data.Basic['PersonalDiscount']);
                    $('#billDetail').html("(#"+response.data.Basic['BillNumber']+"-"+response.data.Basic['BillType']+")" );

                    var i;
                    for (i = 0; i < response.data.Items.length; i++) {
                        $('#itemTableReport tbody').append('<tr id ="' + response.data.Items[i]['ItemID'] + '" ><td id ="row' + response.data.Items[i]['ItemID'] + '">#</td> <td id ="product' + response.data.Items[i]['ItemID'] + '">' + response.data.Items[i]['ItemProductName'] + '</td><td id ="category' + response.data.Items[i]['ItemID'] + '">' + response.data.Items[i]['ItemCategory'] + '</td><td id ="hsn' + response.data.Items[i]['ItemID'] + '">' + response.data.Items[i]['ItemHsn'] + '</td><td id ="quantity' + response.data.Items[i]['ItemID'] + '">' + response.data.Items[i]['ItemQuantity'] + '</td><td id ="unit' + response.data.Items[i]['ItemID'] + '">' + response.data.Items[i]['ItemUnit'] + '</td><td id ="price' + response.data.Items[i]['ItemID'] + '">' + response.data.Items[i]['ItemRate'] + '</td><td id ="gst' + response.data.Items[i]['ItemID'] + '">' + response.data.Items[i]['ItemGst'] + '</td><td id ="disc' + response.data.Items[i]['ItemID'] + '">' + response.data.Items[i]['ItemDisc'] + '</td><td id ="netprice' + response.data.Items[i]['ItemnetRate'] + '">' + response.data.Items[i]['ItemnetRate'] + '</td></tr>');

                    }
                    }
                    else{
  $('#showDiv').css('display','none');
                            $('body')
                        .toast({
                            class: 'orange',
                            message: 'No Invoice detail found! Please try again.'
                        })
                    ;
                    }





                },

                error: function () {
                      $('#showDiv').css('display','none');
                    $('body')
                        .toast({
                            class: 'error',
                            message: 'An error occurred !'
                        })
                    ;
                }
            });


        } else {
                  $('#showDiv').css('display','none');
                           $('body')
                        .toast({
                            class: 'orange',
                            message: 'Invoice number required !'
                        })
                    ;
            }
        }


    </script>

{% endblock %}