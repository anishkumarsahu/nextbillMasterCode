{% extends 'home/index.html' %}
{% load static %}
{% block title %}
    <title>Return</title>
{% endblock %}
{% block css %}
{% endblock %}
{% block body %}
  <style>
     #expenseTable_length {
            left: 10px;
            position: absolute;
        }

        #expenseTable_filter {
            float: right;
        }

        .dt-buttons {
            position: absolute;
            left: 200px;
        }
  label{
      float: left;
  }
  .segment{
      padding-top: 3px!important;
      padding-bottom: 0!important;
  }
    </style>
    <div class="ui right aligned basic  segment" style="padding-top: 0;">
                <div class="ui bottom attached segment" style="margin-top: 0;padding-bottom: 0;">
                    <form class="ui tiny form" id="expenseForm">
                        <h4 class="ui  left aligned  dividing header">RETURN</h4>

                        <div class="four fields">

                            <div class="field"> </div>

                            <div class="field">
                                <label>Invoice Number</label>
                                <input type="text" name="description" id="description" placeholder="Invoice Number">
                            {% csrf_token %}
                            </div>

                            <div class="field" style="padding-top: 1.666em;">
                                <button type="button" class="ui fluid green button" onclick="addExpense()">
                                    <i class="icon search"></i>
                                    Search Invoice
                                </button>
                            </div>
                             <div class="field"> </div>
                        </div>

                    </form>
                </div>

                </div>
<div class="ui basic segment">
<h5 class="ui horizontal left aligned divider header">
                        <i class="left align icon"></i>
                        Invoice Detail
                    </h5>
     <div class="content" >
            <div class="description">


                    <div class="ui pointing secondary menu">
                        <a class="item active" data-tab="first">Basic Details</a>
                        <a class="item" data-tab="second">Addition Details</a>
                    </div>
                    <div class="ui tab segment active" data-tab="first">
                        <div class="ui internally grid">
                            <div class="row" style="padding-top: 1.5rem;padding-bottom: 1.5rem;" >
                                <div class="three wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="user icon"></i>
                                            <div class="content">
                                                <a class="header">Name:</a>
                                                <div class="description" id="CustName">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="registered icon"></i>
                                            <div class="content">
                                                <a class="header">GST Reg :</a>
                                                <div class="description" id="custGst">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="mobile icon"></i>
                                            <div class="content">
                                                <a class="header">Phone Number:</a>
                                                <div class="description" id="custPhone">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="mail icon"></i>
                                            <div class="content">
                                                <a class="header">Email:</a>
                                                <div class="description" id="custEmail">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="map marker alternate icon"></i>
                                            <div class="content">
                                                <a class="header">Address:</a>
                                                <div class="description" id="custAddress">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="street view icon"></i>
                                            <div class="content">
                                                <a class="header">State :</a>
                                                <div class="description" id="custState">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="two wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="amazon pay icon"></i>
                                            <div class="content">
                                                <a class="header">Payment Type:</a>
                                                <div class="description" id="sPaymentType">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="scroll icon"></i>
                                            <div class="content">
                                                <a class="header"> Invoice No:</a>
                                                <div class="description" id="sInvoice">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="calendar alternate icon"></i>
                                            <div class="content">
                                                <a class="header">Date :</a>
                                                <div class="description" id="sInvoiceDate">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="two wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="sticky note outline icon"></i>
                                            <div class="content">
                                                <a class="header">Sub Total:</a>
                                                <div class="description" id="sSubTotal">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="percent icon"></i>
                                            <div class="content">
                                                <a class="header">Discount Pc:</a>
                                                <div class="description" id="sDiscount">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="pencil alternate icon"></i>
                                            <div class="content">
                                                <a class="header">Taxable :</a>
                                                <div class="description" id="sTaxable">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="two wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">

                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="registered icon"></i>
                                            <div class="content">
                                                <a class="header">GST:</a>
                                                <div class="description" id="sBillGst">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="bullseye icon"></i>
                                            <div class="content">
                                                <a class="header">Round Off:</a>
                                                <div class="description" id="sRoundOff">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="people carry icon"></i>
                                            <div class="content">
                                                <a class="header">Other Charges :</a>
                                                <div class="description" id="sOtherCharges">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="two wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                        <i class="gem icon"></i>
                                        <div class="content">
                                            <a class="header">Personal Discount:</a>
                                            <div class="description" id="sPersonalDiscount">N/A</div>
                                        </div>
                                    </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="wallet icon"></i>
                                            <div class="content">
                                                <a class="header">Total :</a>
                                                <div class="description" id="sGrandTotal">N/A</div>
                                            </div>
                                        </div>

                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="money bill wave icon"></i>
                                            <div class="content">
                                                <a class="header">Paid Amount:</a>
                                                <div class="description" id="PaidAgainstBill">N/A</div>
                                            </div>
                                        </div>


                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>
                    <div class="ui  tab segment" data-tab="second">
                        <div class="ui internally grid">
                            <div class="row" style="padding-top: 1.5rem;padding-bottom: 1.5rem;" >
                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="handshake icon"></i>
                                            <div class="content">
                                                <a class="header">Credit Days:</a>
                                                <div class="description" id="CreditDays">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="file alternate outline icon"></i>
                                            <div class="content">
                                                <a class="header">Cheque Detail :</a>
                                                <div class="description" id="chequeDetail">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="paperclip icon"></i>
                                            <div class="content">
                                                <a class="header">Delivery Note:</a>
                                                <div class="description" id="deliveryNote">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="check double icon"></i>
                                            <div class="content">
                                                <a class="header">Supplier Reference:</a>
                                                <div class="description" id="SupplierReference">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="clipboard check icon"></i>
                                            <div class="content">
                                                <a class="header">Buyers Order Number:</a>
                                                <div class="description" id="BuyersOrderNumber">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="clipboard list icon"></i>
                                            <div class="content">
                                                <a class="header">Dispatch Document Number :</a>
                                                <div class="description" id="DispatchDocumentNumber">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="shipping fast icon"></i>
                                            <div class="content">
                                                <a class="header">Dispatch Through:</a>
                                                <div class="description" id="DispatchThrough">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="pen fancy icon"></i>
                                            <div class="content">
                                                <a class="header"> Other Reference:</a>
                                                <div class="description" id="OtherReference">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="calendar check icon"></i>
                                            <div class="content">
                                                <a class="header">Dispatch Note Date :</a>
                                                <div class="description" id="DispatchNoteDate">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                                <div class="four wide column" style="text-align: left;">
                                    <div class="ui very relaxed list">
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="warehouse icon"></i>
                                            <div class="content">
                                                <a class="header">Destination:</a>
                                                <div class="description" id="Destination">N/A</div>
                                            </div>
                                        </div>
                                        <div class="item" style="padding-bottom: 0;">
                                            <i class="user circle icon"></i>
                                            <div class="content">
                                                <a class="header">AddedBy:</a>
                                                <div class="description" id="AddedBy">N/A</div>
                                            </div>
                                        </div>
                                    </div>
                                </div>

                            </div>
                        </div>
                    </div>


            </div>
        </div>
</div>
<div class="ui basic segment">
<h5 class="ui horizontal left aligned divider header">
                        <i class="left align icon"></i>
                        Product List
                    </h5>
<table class="ui compact celled definition table">
  <thead class="full-width">
    <tr>
      <th></th>
      <th>Name</th>
      <th>Registration Date</th>
      <th>E-mail address</th>
      <th>Premium Plan</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td class="collapsing">
        <div class="ui fitted slider checkbox">
          <input type="checkbox"> <label></label>
        </div>
      </td>
      <td>John Lilki</td>
      <td>September 14, 2013</td>
      <td>jhlilk22@yahoo.com</td>
      <td>No</td>
    </tr>
    <tr>
      <td class="collapsing">
        <div class="ui fitted slider checkbox">
          <input type="checkbox"> <label></label>
        </div>
      </td>
      <td>Jamie Harington</td>
      <td>January 11, 2014</td>
      <td>jamieharingonton@yahoo.com</td>
      <td>Yes</td>
    </tr>
    <tr>
      <td class="collapsing">
        <div class="ui fitted slider checkbox">
          <input type="checkbox"> <label></label>
        </div>
      </td>
      <td>Jill Lewis</td>
      <td>May 11, 2014</td>
      <td>jilsewris22@yahoo.com</td>
      <td>Yes</td>
    </tr>
  </tbody>
  <tfoot class="full-width">
    <tr>
      <th></th>
      <th colspan="4">
        <div class="ui right floated small primary labeled icon button">
          <i class="user icon"></i> Add User
        </div>
        <div class="ui small  button">
          Approve
        </div>
        <div class="ui small  disabled button">
          Approve All
        </div>
      </th>
    </tr>
  </tfoot>
</table>
</div>

        <div class="ui basic modal custom" id="delHSNModal">
        <div class="ui icon header">
            <i class="archive icon"></i>
            Expense detail will be Deleted.
        </div>
        <div class="content">
            <p style="text-align: center">The Expense detail will be deleted, are you sure to delete
                this Expense?</p>
        </div>
        <div class="actions">
            <div class="ui red basic cancel inverted button">
                <i class="remove icon"></i>
                No
            </div>
            <input type="hidden" id="dHSNID">
            <div class="ui green ok inverted button" onclick="deleteHSN()">
                <i class="checkmark icon"></i>
                Yes
            </div>
        </div>
    </div>

{% endblock %}


{% block js %}
    <script>
     $('.menu .item').tab();
        let today = new Date();
        $('#standard_calendar')
            .calendar({
                initialDate: today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear(),
                monthFirst: false,
                type: 'date',
                formatter: {
                        date: function (date, settings) {
                            if (!date) return '';
                            var day = date.getDate();
                            var month = date.getMonth() + 1;
                            var year = date.getFullYear();
                            return day + '/' + month + '/' + year;
                        }
                    }
                }
            );
     $('#rangestart').calendar({
            initialDate: today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear(),
         monthFirst: false,
         type: 'date',
            endCalendar: $('#rangeend'),
            formatter: {
                date: function (date, settings) {
                    if (!date) return '';
                    var day = date.getDate();
                    var month = date.getMonth() + 1;
                    var year = date.getFullYear();
                    return day + '/' + month + '/' + year;
                }
            }
        });
        $('#rangeend').calendar({
            initialDate: today.getDate() + '/' + (today.getMonth() + 1) + '/' + today.getFullYear(),
            monthFirst: false,
            type: 'date',
            startCalendar: $('#rangestart'),
            formatter: {
                date: function (date, settings) {
                    if (!date) return '';
                    var day = date.getDate();
                    var month = date.getMonth() + 1;
                    var year = date.getFullYear();
                    return day + '/' + month + '/' + year;
                }
            }
        });

     function addExpense() {
            var description = $('#description').val();
            var amount = $('#amount').val();
            var date = $('#date').val();
            var expenseType = $('#expenseType').val();
            var company = $('#company').val();
            if (description === '' || amount === ''|| date === ''|| expenseType === '') {
                $('body')
                    .toast({
                        class: 'orange',
                        message: 'All fields are required !'
                    })
                ;
            }
            else {

                var csrfmiddlewaretoken = $("input[name='csrfmiddlewaretoken']").val();

                data = new FormData();
                data.append('description', description);
                data.append('amount', amount);
                data.append('date', date);
                data.append('expenseType', expenseType);
                data.append('company', company);

                data.append('csrfmiddlewaretoken', csrfmiddlewaretoken);

                $.ajax({
                    type: 'post',
                    url: '{% url 'homeApp:add_expense' %}',
                    data: data,
                    contentType: false,
                    cache: false,
                    processData: false,


                    success: function (response) {
                        if (response.message === 'success') {
                            $('body')
                                .toast({
                                    class: 'success',
                                    message: 'Expense Added Successfully.'
                                })
                            ;

                            expenseTab.ajax.reload();
                            $('#expenseForm').trigger('reset')
                        }
                        else {
                            $('body')
                                .toast({
                                    class: 'error',
                                    message: 'An error occurred !'
                                })
                            ;

                        }

                        return response;
                    },
                    error: function () {
                        $('body')
                            .toast({
                                class: 'error',
                                message: 'An error occurred !'
                            })
                        ;
                    }
                });


            }

        }

        $(getExpense());
        var expenseTab;
        function getExpense() {
                  var startDate = $('#startDateF').val();
            var endDate = $('#endDateF').val();

             expenseTab = $('#expenseTable').DataTable({
                dom: 'Blfrtip',
                "scrollY":"215px",
                buttons: [{
                    extend: 'excel',
                    exportOptions: {
                        columns: [0, 1, 2,3,4]
                    }},{
                    extend: 'print',
                    exportOptions: {
                        columns: [0, 1, 2,3,4]
                    }}
                ],
                "columnDefs": [
                    {"name": "expenseType", "targets": 0, "orderable": true},
                    {"name": "description", "targets": 1, "orderable": true},
                    {"name": "amount", "targets": 2, "orderable": true},
                    {"name": "companyID", "targets": 3, "orderable": true},
                    {"name": "expenseDate", "targets":4, "orderable": true},
                    {"name": "datetime", "targets":5, "orderable": true},
                    {"name": "action", "targets":6, "orderable": true},

                ],
                aaSorting: [[4, 'desc']],
                "lengthMenu": [[6, 25, 50, 100, -1], [6, 25, 50, 100, "All"]],
                "pageLength": 6,
                "processing": true,
                "serverSide": true,
                "ajax": '{% url 'homeApp:ExpenseListJson' %}?startDate=' + startDate + '&endDate=' + endDate
            });
        }
  function filterDetails() {
                      var startDate = $('#startDateF').val();
                    var endDate = $('#endDateF').val();
                    expenseTab.ajax.url( '{% url 'homeApp:ExpenseListJson' %}?startDate=' + startDate + '&endDate=' + endDate ).load();

                }
                      function delExpense(id) {
            $('#delHSNModal')
                .modal('show')
            ;
            $('#dHSNID').val(id)
        }

        function deleteHSN() {
            var id = $('#dHSNID').val();
            var formdata = new FormData();
            formdata.append('ID', id);
            $.ajax({
                url: "{% url 'homeApp:delete_expense' %}",
                type: "post",
                data: formdata,
                contentType: false,
                cache: false,
                processData: false,

                success: function (response) {
                    if (response.message === 'success') {
                        $('body')
                            .toast({
                                class: 'success',
                                message: 'Expense Detail Deleted Successfully.'
                            })
                        ;


                        expenseTab.ajax.reload();
                    } else {
                        $('body')
                            .toast({
                                class: 'error',
                                message: 'An error occurred !'
                            })
                        ;

                    }

                    return response;
                },
                error: function () {
                    $('body')
                        .toast({
                            class: 'error',
                            message: 'An error occurred !'
                        })
                    ;
                }
            });

        }



    </script>

{% endblock %}